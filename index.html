<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SC THE ADVENTURE | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --primary:#2563eb;
  --danger:#dc2626;
  --bg:#f1f5f9;
}
*{box-sizing:border-box}
body{margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg)}
header{
  background:linear-gradient(90deg,#1e3a8a,#2563eb);
  color:#fff;padding:22px 32px;font-size:24px;font-weight:700
}
.container{padding:32px;max-width:1700px;margin:auto}
button,input,textarea,select{
  width:100%;padding:14px;border-radius:16px;
  border:1px solid #c7d2fe;font-size:14px
}
button{
  background:var(--primary);color:#fff;border:none;
  cursor:pointer;font-weight:600;transition:.2s
}
button:active{transform:scale(.95)}
button.danger{
  background:linear-gradient(135deg,#dc2626,#991b1b);
  box-shadow:0 10px 25px rgba(220,38,38,.35)
}
.card{
  background:#fff;border-radius:28px;padding:32px;
  margin-bottom:30px;box-shadow:0 25px 50px rgba(0,0,0,.12)
}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:22px}
.table{width:100%;border-collapse:collapse;border-radius:26px;overflow:hidden}
th,td{padding:18px;border-bottom:1px solid #e5e7eb;vertical-align:top}
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.65);
  display:none;align-items:center;justify-content:center
}
.modal-box{
  background:#fff;width:96%;max-width:1500px;
  border-radius:36px;padding:44px;
  max-height:92vh;overflow:auto;animation:pop .25s ease
}
@keyframes pop{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.confirm-box{max-width:520px;text-align:center}
.form-grid{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));
  gap:26px;margin:26px 0
}
textarea{min-height:120px}
.detail-row{
  display:grid;grid-template-columns:240px 1fr;
  gap:14px;padding:10px 0;border-bottom:1px dashed #e5e7eb
}
.detail-row b{color:#1e3a8a}
</style>
</head>

<body>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyCowDEvUQpBmq7AwUGiC6IuGOudPhi_0kM",
  authDomain: "vehicle-maintenance-64890.firebaseapp.com",
  projectId: "vehicle-maintenance-64890",
});
const db = firebase.firestore();
</script>

<header>üöó SC THE ADVENTURE | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</header>

<div class="container">

<div class="card grid">
  <select id="vehicleSelect"></select>
  <button onclick="openModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</button>
  <button class="danger" onclick="confirmDeleteAll()">üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏ñ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<div class="card">
<table class="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
<th>‡∏£‡∏ñ</th>
<th>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°</th>
<th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢</th>
<th>‡∏ä‡πà‡∏≤‡∏á</th>
<th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</th>
<th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
<th>‡∏•‡∏ö</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

</div>

<!-- modal ‡πÄ‡∏û‡∏¥‡πà‡∏° -->
<div class="modal" id="modal">
<div class="modal-box">
<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h2>
<div class="form-grid">
<input id="plate" placeholder="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ">
<input id="brand" placeholder="‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏£‡∏ñ">
<input id="model" placeholder="‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ">
<input type="date" id="date">
<input id="mileage" placeholder="‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå">
<input id="jobNo" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏á‡∏≤‡∏ô">
<input id="system" placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°">
<input id="technician" placeholder="‡∏ä‡πà‡∏≤‡∏á">
<input id="approver" placeholder="‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥">
<textarea id="symptoms" placeholder="‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢"></textarea>
<textarea id="parts" placeholder="‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô"></textarea>
<textarea id="note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"></textarea>
<input type="number" id="partsCost" placeholder="‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà">
<input type="number" id="laborCost" placeholder="‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á">
</div>
<div class="grid">
<button onclick="confirmSave()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
<button class="danger" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>
</div>
</div>

<!-- confirm -->
<div class="modal" id="confirmModal">
<div class="modal-box confirm-box">
<h2 id="confirmTitle"></h2>
<p id="confirmText"></p>
<div class="grid">
<button onclick="confirmYes()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
<button class="danger" onclick="closeConfirm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>
</div>
</div>

<!-- detail -->
<div class="modal" id="detailModal">
<div class="modal-box">
<h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h2>
<div id="detailContent"></div>
<button class="danger" onclick="detailModal.style.display='none'">‡∏õ‡∏¥‡∏î</button>
</div>
</div>

<script>
const modal = document.getElementById("modal");
const confirmModal = document.getElementById("confirmModal");
const detailModal = document.getElementById("detailModal");
const vehicleSelect = document.getElementById("vehicleSelect");
const tbody = document.getElementById("tbody");
let confirmAction = null;

function openModal(){modal.style.display="flex"}
function closeModal(){modal.style.display="none"}

function openConfirm(t,txt,fn){
  confirmTitle.textContent=t;
  confirmText.textContent=txt;
  confirmAction=fn;
  confirmModal.style.display="flex";
}
function closeConfirm(){confirmModal.style.display="none";confirmAction=null}
function confirmYes(){if(confirmAction) confirmAction();closeConfirm()}

function confirmSave(){
  openConfirm("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?",save);
}

function loadVehicles(){
  db.collection("vehicles").onSnapshot(s=>{
    vehicleSelect.innerHTML="";
    s.forEach(d=>{
      const o=document.createElement("option");
      o.value=d.id;o.textContent=d.id;
      vehicleSelect.appendChild(o);
    });
    if(vehicleSelect.value) loadRepairs(vehicleSelect.value);
  });
}
vehicleSelect.onchange=()=>loadRepairs(vehicleSelect.value);

function loadRepairs(v){
  db.collection("vehicles").doc(v).collection("repairs")
  .onSnapshot(s=>{
    tbody.innerHTML="";
    s.forEach(doc=>{
      const r=doc.data();
      const cost=(+r["‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà"]||0)+(+r["‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á"]||0);
      tbody.innerHTML+=`
<tr>
<td>${r["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"]||""}</td>
<td>${v}</td>
<td>${r["‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°"]||""}</td>
<td>${r["‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢"]||""}</td>
<td>${r["‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö"]||""}</td>
<td>${cost}</td>
<td><button onclick='openDetail(${JSON.stringify(r).replace(/'/g,"&#39;")})'>‡∏î‡∏π</button></td>
<td>
  <button class="danger"
    data-vehicle="${v}"
    data-id="${doc.id}"
    onclick="deleteFromBtn(this)">
    ‡∏•‡∏ö
  </button>
</td>
</tr>`;
    });
  });
}

function save(){
  const key=plate.value+" "+brand.value+" "+model.value;
  const ref=db.collection("vehicles").doc(key);
  ref.set({updated:new Date()},{merge:true});
  ref.collection("repairs").add({
    "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà":date.value,
    "‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå":mileage.value,
    "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏á‡∏≤‡∏ô":jobNo.value,
    "‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°":system.value,
    "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢":symptoms.value,
    "‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô":parts.value,
    "‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö":technician.value,
    "‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥":approver.value,
    "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏":note.value,
    "‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà":partsCost.value,
    "‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á":laborCost.value,
    "‡πÄ‡∏ß‡∏•‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å":new Date()
  }).then(closeModal);
}

function deleteFromBtn(btn){
  const v=btn.dataset.vehicle;
  const id=btn.dataset.id;
  openConfirm(
    "‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°",
    "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?",
    ()=>db.collection("vehicles").doc(v).collection("repairs").doc(id).delete()
  );
}

async function confirmDeleteAll(){
  if(!vehicleSelect.value) return;
  const name=vehicleSelect.value;
  openConfirm(
    "‡∏•‡∏ö‡∏£‡∏ñ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
    `‡∏•‡∏ö‡∏£‡∏ñ "${name}" ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
    async ()=>{
      const ref=db.collection("vehicles").doc(name);
      const snap=await ref.collection("repairs").get();
      const batch=db.batch();
      snap.forEach(d=>batch.delete(d.ref));
      await batch.commit();
      await ref.delete();
      vehicleSelect.value="";
      tbody.innerHTML="";
    }
  );
}

function openDetail(d){
  let html="";
  for(const k in d){
    html+=`<div class="detail-row"><b>${k}</b><div>${d[k]||"-"}</div></div>`;
  }
  detailContent.innerHTML=html;
  detailModal.style.display="flex";
}

loadVehicles();
</script>

<script>
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("./sw.js");
}
</script>

</body>
</html>
