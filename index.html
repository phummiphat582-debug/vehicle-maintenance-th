<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>SC THE ADVENTURE | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<style>
:root{
  --primary:#2563eb;
  --danger:#dc2626;
  --bg:#f1f5f9;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  background:var(--bg)
}
header{
  background:linear-gradient(90deg,#1e3a8a,#2563eb);
  color:#fff;
  padding:22px 32px;
  font-size:24px;
  font-weight:700
}
.container{
  padding:32px;
  max-width:1700px;
  margin:auto
}
button,input,textarea,select{
  width:100%;
  padding:14px;
  border-radius:16px;
  border:1px solid #c7d2fe;
  font-size:14px
}
button{
  background:var(--primary);
  color:#fff;
  border:none;
  cursor:pointer;
  font-weight:600;
  transition:.2s
}
button:active{transform:scale(.95)}
button.danger{
  background:linear-gradient(135deg,#dc2626,#991b1b);
  box-shadow:0 10px 25px rgba(220,38,38,.35)
}
.card{
  background:#fff;
  border-radius:28px;
  padding:32px;
  margin-bottom:30px;
  box-shadow:0 25px 50px rgba(0,0,0,.12)
}
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
  gap:22px
}
.table{
  width:100%;
  border-collapse:collapse;
  overflow:hidden;
  border-radius:26px
}
th,td{
  padding:18px;
  border-bottom:1px solid #e5e7eb;
  vertical-align:top
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center
}
.modal-box{
  background:#fff;
  width:96%;
  max-width:1500px;
  border-radius:36px;
  padding:44px;
  max-height:92vh;
  overflow:auto;
  animation:pop .25s ease
}
@keyframes pop{
  from{opacity:0;transform:scale(.9)}
  to{opacity:1;transform:scale(1)}
}
.confirm-box{
  max-width:520px;
  text-align:center
}
.form-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(340px,1fr));
  gap:26px;
  margin:26px 0
}
textarea{min-height:120px}
.badge{
  padding:6px 16px;
  border-radius:999px;
  font-size:12px;
  font-weight:700
}
.NEW{background:#fee2e2;color:#991b1b}
.detail-row{
  display:grid;
  grid-template-columns:220px 1fr;
  gap:14px;
  padding:10px 0;
  border-bottom:1px dashed #e5e7eb
}
.detail-row b{color:#1e3a8a}
</style>
</head>

<body>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({
  apiKey: "AIzaSyCowDEvUQpBmq7AwUGiC6IuGOudPhi_0kM",
  authDomain: "vehicle-maintenance-64890.firebaseapp.com",
  projectId: "vehicle-maintenance-64890",
});
const db=firebase.firestore();
</script>

<header>üöó SC THE ADVENTURE | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</header>

<div class="container">

<div class="card grid">
  <select id="vehicleSelect"></select>
  <button onclick="openModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</button>
  <button class="danger" onclick="confirmDeleteAll()">üóëÔ∏è ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<div class="card">
<table class="table">
<thead>
<tr>
<th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏ñ</th><th>‡∏£‡∏∞‡∏ö‡∏ö</th><th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</th>
<th>‡∏ä‡πà‡∏≤‡∏á</th><th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
<th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th><th>‡∏•‡∏ö</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</div>

</div>

<!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
<div class="modal" id="modal">
<div class="modal-box">
<h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h2>

<div class="form-grid">
<input id="plate" placeholder="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ">
<input id="brand" placeholder="‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏£‡∏ñ">
<input id="model" placeholder="‡∏£‡∏∏‡πà‡∏ô‡∏£‡∏ñ">
<input type="date" id="date">
<input id="system" placeholder="‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°">
<input id="technician" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≤‡∏á">
<textarea id="symptoms" placeholder="‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏µ‡∏¢ / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"></textarea>
<input type="number" id="partsCost" placeholder="‡∏Ñ‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà">
<input type="number" id="laborCost" placeholder="‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á">
</div>

<div class="grid">
<button onclick="confirmSave()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
<button class="danger" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>
</div>
</div>

<!-- confirm -->
<div class="modal" id="confirmModal">
<div class="modal-box confirm-box">
<h2 id="confirmTitle"></h2>
<p id="confirmText" style="margin:20px 0;color:#374151"></p>
<div class="grid">
<button onclick="confirmYes()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
<button class="danger" onclick="closeConfirm()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>
</div>
</div>

<!-- detail -->
<div class="modal" id="detailModal">
<div class="modal-box">
<h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h2>
<div id="detailContent"></div>
<button class="danger" onclick="detailModal.style.display='none'">‡∏õ‡∏¥‡∏î</button>
</div>
</div>

<script>
let confirmAction=null;

function openModal(){modal.style.display='flex'}
function closeModal(){modal.style.display='none'}

function openConfirm(t,txt,fn){
  confirmTitle.textContent=t;
  confirmText.textContent=txt;
  confirmAction=fn;
  confirmModal.style.display='flex';
}
function closeConfirm(){
  confirmModal.style.display='none';
  confirmAction=null;
}
function confirmYes(){
  if(confirmAction) confirmAction();
  closeConfirm();
}

function confirmSave(){
  openConfirm("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°?",save);
}

function loadVehicles(){
  db.collection("vehicles").onSnapshot(s=>{
    vehicleSelect.innerHTML="";
    s.forEach(d=>{
      let o=document.createElement("option");
      o.value=d.id;o.textContent=d.id;
      vehicleSelect.appendChild(o);
    });
    if(vehicleSelect.value) loadRepairs(vehicleSelect.value);
  });
}
vehicleSelect.onchange=()=>loadRepairs(vehicleSelect.value);

function loadRepairs(v){
  db.collection("vehicles").doc(v).collection("repairs")
  .onSnapshot(s=>{
    tbody.innerHTML="";
    s.forEach(doc=>{
      let r=doc.data();
      let cost=(+r.partsCost||0)+(+r.laborCost||0);
      tbody.innerHTML+=`
<tr>
<td>${r.date||""}</td>
<td>${v}</td>
<td>${r.system||""}</td>
<td>${r.symptoms||""}</td>
<td>${r.technician||""}</td>
<td>${cost}</td>
<td><span class="badge NEW">NEW</span></td>
<td><button onclick='openDetail(${JSON.stringify(r)})'>‡∏î‡∏π</button></td>
<td><button class="danger" onclick="deleteRec('${v}','${doc.id}')">‡∏•‡∏ö</button></td>
</tr>`;
    });
  });
}

function save(){
  let key=plate.value+" "+brand.value+" "+model.value;
  let ref=db.collection("vehicles").doc(key);
  ref.set({updated:new Date()},{merge:true});
  ref.collection("repairs").add({
    date:date.value,system:system.value,symptoms:symptoms.value,
    technician:technician.value,
    partsCost:partsCost.value,laborCost:laborCost.value,
    createdAt:new Date()
  }).then(closeModal);
}

function deleteRec(v,id){
  openConfirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£","‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?",
    ()=>db.collection("vehicles").doc(v).collection("repairs").doc(id).delete()
  );
}

function confirmDeleteAll(){
  openConfirm("‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î","‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ?",
    ()=>{
      db.collection("vehicles").doc(vehicleSelect.value)
      .collection("repairs").get().then(s=>{
        let b=db.batch();
        s.forEach(d=>b.delete(d.ref));
        b.commit();
      });
    }
  );
}

function openDetail(d){
  let h="";
  Object.keys(d).forEach(k=>{
    h+=`<div class="detail-row"><b>${k}</b><div>${d[k]}</div></div>`;
  });
  detailContent.innerHTML=h;
  detailModal.style.display="flex";
}

loadVehicles();
</script>

</body>
</html>
